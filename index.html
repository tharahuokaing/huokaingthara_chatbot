<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huokaingthara Sentient OS v6.0</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        :root {
            --holo-blue: #00f2ff;
            --holo-green: #00ff41;
            --bg-dark: #020b10;
            --scanline: rgba(0, 242, 255, 0.1);
        }

        body {
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 50%, #0a2a3a 0%, #020b10 100%),
                              linear-gradient(var(--scanline) 50%, transparent 50%);
            background-size: 100% 100%, 100% 4px;
            color: var(--holo-blue);
            font-family: 'Courier New', monospace;
            margin: 0; display: flex; height: 100vh; overflow: hidden;
            animation: flicker 0.15s infinite;
        }

        /* --- Login Overlay --- */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 10001; display: flex;
            align-items: center; justify-content: center; flex-direction: column;
            border: 2px solid var(--holo-blue);
        }

        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: var(--holo-green); z-index: 9999;
            padding: 20px; overflow: hidden; display: none;
        }

        #sidebar {
            width: 360px; background: rgba(2, 11, 16, 0.9);
            border-right: 1px solid var(--holo-blue);
            backdrop-filter: blur(10px); padding: 20px;
            display: flex; flex-direction: column; z-index: 10;
        }

        #chat-output {
            flex-grow: 1; overflow-y: auto; border: 1px solid var(--holo-blue);
            background: rgba(0, 242, 255, 0.05); padding: 10px; margin-bottom: 15px;
            box-shadow: inset 0 0 15px rgba(0, 242, 255, 0.2);
        }

        .ai-msg { color: var(--holo-green); text-shadow: 0 0 8px var(--holo-green); border-left: 2px solid var(--holo-green); padding-left: 10px; margin-bottom: 15px; }
        .user-msg { color: #fff; opacity: 0.7; margin: 10px 0; font-size: 0.8em; }

        input { background: rgba(0, 242, 255, 0.1); border: 1px solid var(--holo-blue); color: var(--holo-blue); padding: 12px; outline: none; }
        button { border: 1px solid var(--holo-blue); background: transparent; color: var(--holo-blue); cursor: pointer; padding: 10px; transition: 0.3s; }
        button:hover { background: var(--holo-blue); color: #000; box-shadow: 0 0 20px var(--holo-blue); }

        @keyframes flicker { 0% { opacity: 0.98; } 100% { opacity: 1; } }
        #visualizer { flex-grow: 1; filter: drop-shadow(0 0 10px var(--holo-blue)); }
    </style>
</head>
<body>

<div id="login-overlay">
    <h2 style="color:var(--holo-blue); text-shadow: 0 0 10px var(--holo-blue);">CORE ACCESS REQUIRED</h2>
    <input type="text" id="login-u" placeholder="Username" style="margin-bottom:10px; width: 250px;">
    <input type="password" id="login-p" placeholder="Password" onkeypress="if(event.key === 'Enter') validateAccess()" style="margin-bottom:10px; width: 250px;">
    <button onclick="validateAccess()" style="width: 275px;">DECRYPT & ENTER</button>
</div>

<div id="boot-screen">
    <div id="boot-logs" style="line-height: 1.6;"></div>
</div>

<div id="sidebar">
    <div id="sys-status" style="font-size: 0.7em; color: yellow; margin-bottom: 5px;">SINGULARITY: ACTIVE</div>
    <h2 style="text-align: center; letter-spacing: 2px;">SENTIENT CORE</h2>
    <div id="chat-output"></div>

    <div style="display: flex; gap: 5px; margin-bottom: 10px;">
        <input type="text" id="userInput" placeholder="áž”áž‰áŸ’áž…áž¼áž›áž”áž‰áŸ’áž‡áž¶..." style="flex:1;">
        <button id="mic-btn">ðŸŽ¤</button>
    </div>

    <div style="font-size: 0.7em; color: #888;">
        TRAIN VIA CSV: <input type="file" id="csvLoader" accept=".csv" style="width: 100%;">
    </div>

    <div style="display: flex; gap: 5px; margin-top: 10px;">
        <button onclick="downloadBrain()" style="flex:1; font-size: 9px;">EXPORT</button>
        <button onclick="localStorage.clear(); location.reload();" style="flex:1; font-size: 9px; color: red;">WIPE</button>
    </div>
</div>

<svg id="visualizer"></svg>

<script src="auth.js"></script>    
<script>
    let brain = {};
    const KEY_PATH = "40798e1e7e780749001b9758782f9d3f11463e27546859560f707f2403f2601a"; // Password: dutyfree

    // --- áŸ¡. áž”áŸ’ážšáž–áŸáž“áŸ’áž’ Login ážŸáž»ážœážáŸ’ážáž·áž—áž¶áž– ---
    async function validateAccess() {
        const u = document.getElementById('login-u').value;
        const p = document.getElementById('login-p').value;
        
        const encoder = new TextEncoder();
        const data = encoder.encode(p);
        const hash = await crypto.subtle.digest('SHA-256', data);
        const pCipher = Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');

        if (u === "huokaingthara" && pCipher === KEY_PATH) {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('boot-screen').style.display = 'block';
            startBootSequence();
        } else {
            alert("ACCESS DENIED: Unauthorized Credentials.");
        }
    }

    // --- áŸ¢. BOOT SEQUENCE ---
    const bootLogs = [
        "[OK] INITIALIZING HUOKAINGTHARA KERNEL v6.0",
        "[OK] DECRYPTING NEURAL PATHWAYS...",
        "[OK] LOADING OFFLINE_CORE_MEMORY...",
        "------------------------------------",
        "STATUS: SENTIENT EVOLUTION READY.",
        "------------------------------------",
        "SYSTEM ONLINE. WELCOME OPERATOR."
    ];

    function startBootSequence() {
        const logContainer = document.getElementById('boot-logs');
        let i = 0;
        const interval = setInterval(() => {
            if (i < bootLogs.length) {
                logContainer.innerHTML += bootLogs[i] + "<br>";
                i++;
            } else {
                clearInterval(interval);
                setTimeout(() => {
                    document.getElementById('boot-screen').style.display = 'none';
                    addLog("<b>[CORE ONLINE]</b><br>Welcome back, Huokaingthara.", "ai-msg");
                    speak("Core initialized. System online.");
                }, 1000);
            }
        }, 180);
    }

    // --- áŸ£. CORE AI LOGIC ---
    const synth = window.speechSynthesis;
    function speak(text) { if (synth) synth.speak(new SpeechSynthesisUtterance(text)); }

    function addLog(text, className) {
        const out = document.getElementById('chat-output');
        out.innerHTML += `<div class="${className}">${text}</div>`;
        out.scrollTop = out.scrollHeight;
    }

    // [Fuzzy Logic & Similarity Engine]
    function getSimilarity(s1, s2) {
        let longer = s1.toLowerCase(), shorter = s2.toLowerCase();
        if (s1.length < s2.length) [longer, shorter] = [shorter, longer];
        if (longer.length === 0) return 1.0;
        return (longer.length - editDistance(longer, shorter)) / parseFloat(longer.length);
    }

    function editDistance(s1, s2) {
        let costs = [];
        for (let i = 0; i <= s1.length; i++) {
            let lastValue = i;
            for (let j = 0; j <= s2.length; j++) {
                if (i === 0) costs[j] = j;
                else if (j > 0) {
                    let newValue = costs[j - 1];
                    if (s1.charAt(i - 1) !== s2.charAt(j - 1))
                        newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                    costs[j - 1] = lastValue;
                    lastValue = newValue;
                }
            }
            if (i > 0) costs[s2.length] = lastValue;
        }
        return costs[s2.length];
    }

    function processInput(q) {
        addLog(`> ${q}`, "user-msg");
        let bestMatch = null, maxScore = 0;
        for (let key in brain) {
            let score = getSimilarity(q, key);
            if (score > maxScore) { maxScore = score; bestMatch = key; }
        }
        if (maxScore > 0.45) {
            addLog(`AI: ${brain[bestMatch]}`, "ai-msg");
            speak(brain[bestMatch]);
        } else {
            addLog(`AI: Unknown pattern. Define it in CSV.`, "ai-msg");
        }
    }

    document.getElementById('userInput').onkeypress = (e) => {
        if (e.key === 'Enter') { processInput(e.target.value); e.target.value = ""; }
    };

    // --- áŸ¤. DATA & VISUALIZER ---
    window.onload = () => {
        const saved = localStorage.getItem('huokaingthara_v6');
        if (saved) brain = JSON.parse(saved);
        updateGraph();
    };

    function updateGraph() {
        const svg = d3.select("#visualizer"), width = window.innerWidth - 360, height = window.innerHeight;
        svg.selectAll("*").remove();
        const nodes = [{id:"CORE", group:1}], links = [];
        Object.keys(brain).slice(-50).forEach(k => {
            nodes.push({id:k, group:2}); links.push({source:"CORE", target:k});
        });
        const sim = d3.forceSimulation(nodes).force("link", d3.forceLink(links).id(d=>d.id)).force("charge", d3.forceManyBody().strength(-100)).force("center", d3.forceCenter(width/2, height/2));
        const l = svg.append("g").selectAll("line").data(links).enter().append("line").attr("stroke", "#002233");
        const n = svg.append("g").selectAll("circle").data(nodes).enter().append("circle").attr("r", d=>d.group===1?8:3).attr("fill", d=>d.group===1?"red":"#00f2ff");
        sim.on("tick", () => { l.attr("x1", d=>d.source.x).attr("y1", d=>d.source.y).attr("x2", d=>d.target.x).attr("y2", d=>d.target.y); n.attr("cx", d=>d.x).attr("cy", d=>d.y); });
    }
</script>
</body>
</html>
